<?xml version="1.0" encoding="UTF-8"?>
<project name="creativeshop-smile-instant-search" default="tests" basedir=".">
    <target name="smile-instant-search:build">
        <if>
            <available file="${project_dir}/vendor/smile/magento2-react" type="dir" />
            <then>
                <echo message="Building Smile Instant Search React Component..."/>

                <if>
                    <available file="${project_dir}/app/etc/config.php" type="file" />
                    <then>
                        <move file="${project_dir}/app/etc/config.php" tofile="${project_dir}/app/etc/config_to_restore.php" />
                    </then>
                </if>

                <touch file="${project_dir}/app/etc/config.php" />
                <mkdir dir="${project_dir}/var/tmp" />

                <exec dir="${project_dir}"
                      command="yarn install"
                      escape="false"
                      passthru="true"
                      checkreturn="true"/>

                <exec dir="${project_dir}"
                      command="yarn build"
                      escape="false"
                      passthru="true"
                      checkreturn="true"/>

                <delete file="${project_dir}/app/etc/config.php" />

                <if>
                    <available file="${project_dir}/app/etc/config_to_restore.php" type="file" />
                    <then>
                        <move file="${project_dir}/app/etc/config_to_restore.php" tofile="${project_dir}/app/etc/config.php" />
                    </then>
                </if>
            </then>
        </if>
    </target>
</project>
